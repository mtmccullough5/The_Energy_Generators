---
title: "Energy Generation Analysis Report"
author: "The Energy Generators"
date: "`r Sys.Date()`"
output:
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(dplyr)
library(usmap)


```

# Group Members

- Richard Abegg
- Matthew McCullough
- Shivani Sharma
- Kevin Tam

# Abstract

The United States uses various energy sources to create electricity. Over time, the energy sources change, resulting in some becoming used more than others. Our data set looks at the monthly United States energy generation per state, type of producer, and type of source from 2001 to 2022. The set is comprised of data collected by the EIA (US Energy Information Administration) which shows the types of energies produced by each state. The following columns of information are collected: year, month, state, type of producer, energy source, and generation. The three major categories of energy sources found from the data set are fossil fuels, nuclear and renewable energy. These energy sources combined with the producer types create energy for the entire country. From this data, we hope the answer the following questions below.


# Introduction

### Questions within the data - Clean up when creating report

- Does the cost of fuel influence the energy production rates? Kevin 
- How has the reduction in renewables cost affected generation numbers? Matt
- Which energy source produces the most energy? Rich
- What is the average yearly production of each energy source by state? Rich mess with this to show 
- Which does the future of renewable energy look like? Shivani - reword how every you need to
- When would you expect renewable energy to surpass fossil fuels? Matt


# Data Collection and Arrangement

```{r}
# Read in Data
energy = read_csv("organised_Gen.csv") # Data in organised_gen is by month from 2001 to 2022
states = read_csv("states.csv") # 51 states inclusive of DC with coal region
og = read_csv("OilandGas.csv") # Daily oil and natural gas prices 01/2000 to 02/2022 
uranium = read_csv("uranium.csv") # Monthly Uranium prices from 01/2000 to 11/2021
coal = read_csv("coal.csv") # Weekly coal prices from 05/2008 to 10/2021

```
```{r}
# generate a whole data set
dateStart = make_date(2008,5,1)
dateEnd = make_date(2021,10,30)

print(dateStart)
print(dateEnd)

# Energy
energyWhole = energy %>%
  mutate(date_col = make_date(year=YEAR,month=MONTH)) %>%
  select(date_col, everything()) %>%
  filter(date_col >= dateStart & date_col <= dateEnd) %>%
  arrange(date_col)
print(energyWhole)
# States
print(states)

# OG
ogWhole = og %>%
  filter(Date >= dateStart & Date <= dateEnd) %>%
  mutate(MONTH = month(Date), YEAR = year(Date)) %>%
  group_by(MONTH, YEAR) %>%
  summarize(
    Price_natural_gas_m = mean(Price_natural_gas, na.rm = T), 
    Price_oil_m = mean(Price_oil, na.rm = T)) %>%
  mutate(date_col = make_date(year=YEAR,month=MONTH)) %>%
  ungroup() %>%
  arrange(date_col) %>%
  select(date_col, Price_natural_gas_m, Price_oil_m)
print(ogWhole)
# Uranium
uraniumWhole = uranium %>%
  mutate(date_col = make_date(year = Year, month = match(Month,month.abb))) %>%
  filter(date_col >= dateStart & date_col <= dateEnd) %>%
  arrange(date_col) %>%
  select(date_col, Price_uran)
print(uraniumWhole)
# Coal
coalWhole = coal %>%
  filter(Week_Ended >= dateStart & Week_Ended <= dateEnd) %>%
  mutate(MONTH = month(Week_Ended), YEAR = year(Week_Ended)) %>%
  group_by(MONTH, YEAR) %>%
  summarize(
    CAP = mean(CAP, na.rm = T), 
    NAP = mean(NAP, na.rm = T), 
    ILB = mean(ILB, na.rm = T), 
    PRB = mean(PRB, na.rm = T), 
    UIB = mean(UIB, na.rm = T)) %>%
  mutate(date_col = make_date(year=YEAR,month=MONTH)) %>%
  ungroup() %>%
  arrange(date_col) %>%
  mutate(
    ALL = (CAP + NAP + ILB + PRB + UIB)/5,
    CAP_NAP = (CAP + NAP)/2,
    ILB_CAP = (ILB + CAP)/2,
    ILB_PRB = (ILB + PRB)/2,
    UIB_PRB = (UIB + PRB)/2,
    UIB_ILB = (UIB + ILB)/2
  ) %>%
  select(date_col, CAP, NAP, ILB, PRB, UIB, ALL, CAP_NAP, ILB_CAP, ILB_PRB, UIB_PRB, UIB_ILB)
print(coalWhole)
```

```{r}
# Join tables into super table
# Prep Coal
coalWholeLong = coalWhole %>%
  pivot_longer(c(CAP, NAP, ILB, PRB, UIB, ALL, CAP_NAP, ILB_CAP, ILB_PRB, UIB_PRB, UIB_ILB))

print(coalWholeLong)

# Build Table
allTableWhole = energyWhole %>%
  left_join(states, by = c("STATE"="Code")) %>%
  select(date_col, STATE, `TYPE OF PRODUCER`,`ENERGY SOURCE`, `GENERATION (Megawatthours)`,Coal_Region) %>%
  pivot_wider(names_from = `ENERGY SOURCE`, values_from = `GENERATION (Megawatthours)`) %>%
  group_by(STATE,date_col,Coal_Region) %>%
  summarize(
    Coal_Gen_Total = sum(Coal, na.rm = T),
    Petroleum_Gen_Total = sum(Petroleum, na.rm = T),
    Natural_Gas_Gen_Total = sum(`Natural Gas`, na.rm = T),
    Hydro_Gen_Total = sum(`Hydroelectric Conventional`, na.rm = T),
    Wind_Gen_Total = sum(Wind, na.rm = T),
    Biomass_Gen_Total = sum(`Other Biomass`, na.rm = T),
    Other_Gen_Total = sum(Other, na.rm = T),
    Other_Gas_Gen_Total = sum(`Other Gases`, na.rm = T),
    Nuclear_Gen_Total = sum(Nuclear, na.rm = T),
    Wood_Gen_Total = sum(`Wood and Wood Derived Fuels`, na.rm = T),
    Storage_Gen_Total = sum(`Pumped Storage`, na.rm = T),
    Solar_Gen_Total = sum(`Solar Thermal and Photovoltaic`, na.rm = T),
    Geothermal_Gen_Total = sum(Geothermal, na.rm = T)
    ) %>%
  left_join(ogWhole, by = c( "date_col"="date_col")) %>%
  left_join(uraniumWhole, by = c( "date_col"="date_col")) %>%
  left_join(coalWholeLong, by = c( "date_col"="date_col", "Coal_Region"="name")) %>%
  rename(Price_coal = value) %>%
  select(-Coal_Region) %>%
  ungroup() %>%
  mutate(Other_Gen_Total_new = 
           Other_Gen_Total + Biomass_Gen_Total + Other_Gas_Gen_Total + 
           Wood_Gen_Total + Petroleum_Gen_Total + Geothermal_Gen_Total +
           Storage_Gen_Total) %>%
  select(
    STATE, date_col, Coal_Gen_Total, Natural_Gas_Gen_Total,
    Hydro_Gen_Total, Wind_Gen_Total, Solar_Gen_Total, 
    Other_Gen_Total_new) %>%
  arrange(date_col)

print(allTableWhole)
```

The main data set is relatively clean, there are a few data points that probably need to be removed. For instance in the skim there is negative megawatt hour generation value in the P0 col which does not make sense. It seems the negative values are related to "Pumped Storage". This will need further investigation.

The start of formatting the price data, sourced from various other data sources then the original energy data set. Pulling in the various csv files in their own formats and making adjustments to a common format with just the data of interest. 

One of the price data sets does not have the monthly fidelity that the overall energy generation data set has, additionally price may be more dependent on region for coal plants which is not feasible to transport in many cases. There is an unresolved issue of relating the price to the generation. Either the generation will have to be summarized to the year or the yearly price data extrapolated. Another possible data set for us to consider is https://data.nasdaq.com/data/EIA/COAL-us-coal-prices-by-region but will require come way to connect the location in the main file to the region in that potential dataset.

At one point with only limited number of rows the original coal price csv was easier to edit by removing the other regions(non-us) than through R parsing.  


# Discussion

## Does the cost of fuel influence the energy production rates?


## How has the reduction in renewables cost affected generation numbers?
```{r}
totalUSSrenewable = allTableWhole %>%
  select(STATE,date_col,Solar_Gen_Total, Wind_Gen_Total) %>%
  group_by(date_col) %>%
  summarise(
    US_Solar_Gen = sum(Solar_Gen_Total), 
    US_Wind_Gen = sum(Wind_Gen_Total))

ggplot(data = totalUSSrenewable) +
  geom_point(mapping = aes(x = date_col, y = US_Solar_Gen)) +
  geom_smooth(mapping = aes(x = date_col, y = US_Solar_Gen)) +
  geom_point(mapping = aes(x = date_col, y = US_Wind_Gen)) + 
  geom_smooth(mapping = aes(x = date_col, y = US_Wind_Gen)) +
  labs(title = "Total US Renewable Gen",
       x = "",
       y = "MWH")


```

```{r}

renewableCost = read_csv("windSolarCost.csv")

print(renewableCost)

ggplot(renewableCost) +
  geom_point(aes(x = year,y = kWcost, color = gen, size=2))+ 
  labs(title = "Renewable Capital Costs",
       x = "",
       y = "$ per kW")+
  scale_x_discrete(limits = c(2010, 2012, 2014, 2016, 2018, 2020))+
  guides(size=FALSE)
```

Plots of Wind and solar costs data with overlay of production on same plot

Linear model of cost to generation

Table of data fit





Most of the dramatic drop in wind renewable capital costs occurred in the early 2000's. 


## Which energy source produces the most energy?

If you look at it simply by total amount generated is clear the number one energy source from 2008-2021 in the entire United States is Coal followed Natural Gas and Nuclear.  Then the other types of energy sources drops of drastically. Note that the data shown in this bar graph is in the millions of Gigawatt hours because of the massive amounts of energy produce over the time period.


```{r}
##Start with bar chart showing overall energy production
##clean up column names
energyWholeClean <- energyWhole
names(energyWholeClean)[names(energyWholeClean) == 'ENERGY SOURCE'] <- 'EnergySource'
names(energyWholeClean)[names(energyWholeClean) == 'GENERATION (Megawatthours)'] <- 'Generation'
energyWholeClean <- energyWholeClean %>%
  mutate(GenerationMilGig = Generation/1000000000) %>%
  mutate(GenerationGig = Generation/1000000)
##energyWholeClean
##Sum up enegry Generation by source in millions of Gig
totalBySourceGig <- energyWholeClean %>% group_by(EnergySource) %>%
  summarize(totalProductionGig = sum(GenerationMilGig), totalProduction = sum(Generation)) %>%
  filter(!EnergySource=="Total") ## remove Total category
##totalBySourceGig
##Sum up enegry Generation by source in gigawatt 
totalBySource <- energyWholeClean %>% group_by(EnergySource,STATE, YEAR) %>%
  summarize(totalProduction = sum(GenerationGig)) %>%
  filter(!EnergySource=="Total") ## remove Total category
##totalBySource
## create bar graph for total production
ggplot(data = totalBySourceGig) +
  geom_bar(aes(y = reorder(EnergySource, totalProductionGig), x = totalProductionGig), stat = "identity") +
  labs(title = "Total Energy Production by Energy Source",
       x = "Energy Generation (Millions of Gigawatthours)",
       y = "Energy Source")
```

Looking at the data simply by total doesn't tell the whole story though. When we look at using a line graph, we find drastic changes in a few of the energy sources.  Clearly there is a shift to move away from using coal as an energy source with the total production almost cuts in half since 2008. The exact opposite can be said for Natural Gas with energy production nearly doubling.  Clearly the country is making efforts to protect the environment by moving from Coal to Natural Gas for its energy.  It is also worth noting that Nuclear energy production has remained level over the entire time period. There are reasons preventing the US from moving to more nuclear production.  The only other real item on note is the gradual increase in production of Wind energy.  Yet more evidence the US is looking to increase cleaner energy.

```{r}
##show data by year 
ggplot(data = totalBySource) +
  geom_bar(aes(y = totalProduction,x = YEAR, group = EnergySource, color = EnergySource, linetype = EnergySource), stat = "identity") +
  labs(title = "Total Energy Production by Energy Source",
       y = "Energy Generation (Gigawatthours)",
       x = "Year")
```


## What is the average yearly production of each energy source by state?

##STILL WORKING on this section
```{r}
library(mapview)
library(sf)
library(rlang)

## create tibble for to get data for 5 key energy sources
avgProdbySourcebyState <- energyWholeClean %>%
##  filter(YEAR=='2008', !EnergySource=='Total', !STATE=='US-TOTAL') %>%  
  filter(EnergySource=='Coal' | EnergySource=='Natural Gas'| EnergySource=='Nuclear'| EnergySource=='Hydroelectric Conventional'| EnergySource=='Wind', !STATE=='US-TOTAL') %>%
  group_by(EnergySource,STATE, YEAR) %>%
  summarise(avgGigHours = mean(GenerationGig))%>%
  filter(avgGigHours >0)
avgProdbySourcebyState
write.csv(avgProdbySourcebyState, "avgProdbySourcebyState.csv", row.names=FALSE)


mapview(avgProdbySourcebyState, zcol='avgGigHours')

##get list of unique states
##variables <- avgProdbySourcebyState %>%
## group_by(STATE) %>%
##  distinct(STATE)
##for each var (STATE) create a line chart showing avg Production by year
##for (var in variables) {
##print(var)
##get data for the STATE being looped on
##stateAvgProd <-  avgProdbySourcebyState %>%
##  filter(STATE=='!!sym(var)')
##Create a chart for state showing average production by energy source
##plot <- ggplot(data = stateAvgProd, aes(x = YEAR, y = avgGigHours, group = EnergySource, color = EnergySource), stat = "identity") +
##    geom_line() +
##    geom_point()
##print(plot)
##}
```

## Which state produced the most of each energy type in the last 10 years?
## Looking at 2011-2021, from end date above
## NOT DONE
library(rlang)

MostEnergyProdbySourcebyState <- energyWholeClean %>%
  filter(YEAR>='2011', YEAR<= '2021') %>% 
  filter(EnergySource=='Coal' | EnergySource=='Natural Gas'| EnergySource=='Nuclear'| EnergySource=='Hydroelectric Conventional'| EnergySource=='Wind', !STATE=='US-TOTAL') %>%
  group_by(EnergySource,STATE, YEAR) %>%
  summarize(TotalProduction = sum(GenerationGig))%>%
  filter(TotalProduction >0) %>%
  arrange(TotalProduction)
MostEnergyProdbySourcebyState




# Conclusions










# Appendix 1 - Data Source

https://www.kaggle.com/datasets/kevinmorgado/us-energy-generation-2001-2022  

https://www.kaggle.com/code/bahadirumutiscimen/major-commodity-prices-data-analysis -> for Oil and Natural Gas  

https://www.kaggle.com/datasets/timmofeyy/-metals-price-changes-within-last-30-years -> for Uranium  

https://ourworldindata.org/grapher/coal-prices?country=~US+Central+Appalachian+coal+spot+price+index+%28BP%29 -> for Coal (may need a different set)  

https://github.com/mtmccullough5/The_Energy_Generators/edit/main/README.md -> Project Repository

https://www.nrel.gov/docs/fy21osti/77324.pdf

https://www.eia.gov/electricity/generatorcosts/

https://www.nrel.gov/docs/fy12osti/54526.pdf 
https://apps.automeris.io/wpd/
